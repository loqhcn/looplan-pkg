(function(c,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue"),require("axios")):typeof define=="function"&&define.amd?define(["exports","vue","axios"],r):(c=typeof globalThis<"u"?globalThis:c||self,r(c.Looplan={},c.Vue,c.axios))})(this,function(c,r,h){"use strict";var kn=Object.defineProperty;var An=(c,r,h)=>r in c?kn(c,r,{enumerable:!0,configurable:!0,writable:!0,value:h}):c[r]=h;var N=(c,r,h)=>An(c,typeof r!="symbol"?r+"":r,h);function L(e,t=!0){if(typeof e!="string")return"";let o=e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/[^a-zA-Z0-9]+/g," ").split(" ");o=o.filter(a=>a!=="");for(let a=0;a<o.length;a++)a===0&&!t?o[a]=o[a].toLowerCase():o[a]=o[a].charAt(0).toUpperCase()+o[a].slice(1).toLowerCase();return o.join("")}const j=[];function Te(e){if(j.find(n=>n.name===e.name)){console.error("网关已存在");return}j.push(e)}async function K(e){var s;console.log("获取组件包",e);let t=null;for(let d in j){let i=j[d];if(i.packages&&((s=i.packages)!=null&&s.includes(e))){t=i;break}}let n=t||j[0];if(!n)throw new Error("没有网关");let o=await h.post(n.url,{name:e});if(o.data.code!==200)throw new Error(o.data.msg);if(!o.data.data.row)throw new Error("组件包不存在");const a=o.data.data.row;return a.loadStatus=0,a}function Z(e,t=100){return new Promise(n=>{const o=setInterval(()=>{e()&&(clearInterval(o),n())},t)})}function Pe(e){return{title:e,name:e,modelType:"none"}}const y={MuloLayer:{name:"MuloLayer",title:"MuloLayer",type:"cdn",version:"v1",cdn:"http://component.loqh.cn/mulo-layer/__version__/mulo-layer.umd.js",styleCdn:[],components:[{title:"测试组件",name:"MuloTest",modelType:"none"}],loadStatus:0}},C={},p={};class Ee{constructor(){N(this,"components",{});N(this,"pkgGatewayLoading",{})}parseComponentName(t){const[n,o]=t.split("@");return`${n}@${L(o)}`}async component(t,n=null){const o=this.parseComponentName(t);if(n){this.components[o]=n;return}console.debug("component 加载组件",o);const[a,s]=o.split("@");if(!y[a]&&j.length)if(this.pkgGatewayLoading[a]==0||this.pkgGatewayLoading[a]==null){this.pkgGatewayLoading[a]=1;try{const i=await K(a);y[a]=i}catch(i){console.error("从网关加载组件包失败",a,i)}}else await Z(()=>!!y[a]);if(!C[a]){const i=await this.getPackage(a);console.log("pkgData",a,i,y),this.registerComponents(y[a],i)}const d=this.getComponentOption(o);return d&&d.styleImportCase==="use"&&d.styleCdn&&await this.loadComponentStyles(a,d),this.isAsyncComponent(a,s)?(console.debug("加载异步组件",o),this.components[o]()):this.components[o]}getComponentOptionObject(t){return typeof t=="string"?Pe(t):t}registerComponents(t,n){console.log("注册组件包",t.name,n),t.components.forEach(o=>{const a=this.getComponentOptionObject(o),s=L(a.name),d=`${t.name}@${s}`;console.log("注册组件",d,n[s]),this.components[d]=n[s]})}getComponentOption(t){const n=this.parseComponentName(t),[o,a]=n.split("@"),s=y[o];if(!s)return;const d=s.components.find(i=>{const m=this.getComponentOptionObject(i);return L(m.name)===a});return d?this.getComponentOptionObject(d):void 0}isAsyncComponent(t,n){const o=y[t];if(!o)return!1;if(o.asyncComponents)return o.asyncComponents.includes(n);const a=o.components.find(s=>{const d=this.getComponentOptionObject(s);return L(d.name)===n});return a?!!this.getComponentOptionObject(a).isAsync:!1}async getPackage(t){console.debug("getPackage 加载组件包",t);let n=y[t];if(!n)throw new Error(`组件包不存在: ${t}`);if(C[t])return C[t];if(n.type==="cdn"){if(n.loadStatus===-1&&(n.loadStatus=0),n.loadStatus===0){n.loadStatus=1;try{n.styleCdn&&n.styleCdn.length>0&&n.styleImportCase==="register"&&await this.loadPackageStyles(t);const o=await this.getOnlineComponentPackage(n);C[t]=o,n.loadStatus=200}catch(o){throw n.loadStatus=-1,o}}n.loadStatus===1&&await this.waitComputeLoad(t)}return C[t]}waitComputeLoad(t){return new Promise(n=>{const o=setInterval(()=>{C[t]&&(clearInterval(o),n())},100)})}addLocalPackage(t,n){y[t.name]=t,C[t.name]=n,this.registerComponents(t,n)}registerPackage(t){t=Object.assign({loadStatus:0,styleImportCase:"register"},t),y[t.name]=t}getOnlineComponentPackage(t){return new Promise((n,o)=>{console.debug(`开始加载在线组件库: %c${t.name}`,"color: blue");const{title:a,name:s,version:d,cdn:i}=t;if(!i){o(new Error(`组件库 ${s} 未设置 CDN 地址`));return}const m=i.replace("__version__",d||""),l=document.createElement("script");l.src=m,l.onload=()=>{window[s]?(console.debug(`已加载在线组件库: %c${s}`,"color: green"),n(window[s]),t.keepOfWindow||delete window[s]):o(new Error(`组件未在全局命名空间中找到: ${s}`)),document.body.removeChild(l)},l.onerror=()=>{document.body.removeChild(l),o(new Error(`加载 ${a||s} 组件库失败`))},document.body.appendChild(l)})}loadPackageStyles(t){const n=y[t];if(!n||!n.styleCdn||n.styleCdn.length===0)return Promise.resolve();console.debug(`加载组件包样式: %c${t}`,"color: blue");const o=n.version||"";p[t]||(p[t]=[]);const a=n.styleCdn.map(s=>new Promise((d,i)=>{const m=s.replace("__version__",o),l=document.createElement("link");l.rel="stylesheet",l.href=m,l.onload=()=>{console.debug(`已加载样式: %c${m}`,"color: green"),d(l)},l.onerror=()=>{console.error(`加载包样式失败: ${m}`),document.head.removeChild(l),i(new Error(`加载 ${n.title||t} 样式失败: ${m}`))},document.head.appendChild(l),p[t].push(l)}));return Promise.all(a).then(()=>{})}async loadComponentStyles(t,n){if(!n.styleCdn||n.styleCdn.length===0)return;console.debug(`加载组件特定样式: %c${t}@${n.name}`,"color: blue");const o=y[t],a=(o==null?void 0:o.version)||"",s=`${t}@${n.name}`;p[s]||(p[s]=[]);const d=n.styleCdn.map(m=>new Promise(l=>{const b=m.replace("__version__",a),u=document.createElement("link");u.rel="stylesheet",u.href=b,u.onload=()=>{console.debug(`已加载组件样式: %c${b}`,"color: green"),l(u)},u.onerror=()=>{console.error(`加载组件样式失败: ${b}`),document.head.removeChild(u),l(null)},document.head.appendChild(u),p[s].push(u)})),i=await Promise.all(d);p[s]=p[s].filter(m=>i.includes(m))}unloadPackageStyles(t){p[t]&&(p[t].forEach(n=>{document.head.contains(n)&&document.head.removeChild(n)}),delete p[t]),Object.keys(p).forEach(n=>{n.startsWith(`${t}@`)&&(p[n].forEach(o=>{document.head.contains(o)&&document.head.removeChild(o)}),delete p[n])})}unloadComponentStyles(t){const n=this.parseComponentName(t);p[n]&&(p[n].forEach(o=>{document.head.contains(o)&&document.head.removeChild(o)}),delete p[n])}getLoadedStyleLinks(){return p}}const k=new Ee,ke={class:"m-tip"},X=r.defineComponent({__name:"asyncLoading",setup(e){const t=r.getCurrentInstance();return console.log("loading instance",t),r.reactive({}),(n,o)=>(r.openBlock(),r.createElementBlock("div",ke," Loading... "))}}),Ae={"[object Number]":"number","[object String]":"string","[object Boolean]":"bool","[object Array]":"array","[object Object]":"object","[object Undefined]":"undefined","[object Function]":"function","[object RegExp]":"regexp","[object Date]":"date","[object Symbol]":"symbol"};class Ie{static typeof(t){let n=Object.prototype.toString.call(t);return Ae[n]||"unknow"}static isArray(t){return Object.prototype.toString.call(t)==="[object Array]"}static isEmpty(t){return t==null?!0:typeof t=="string"?t.trim()==="":Array.isArray(t)?t.length===0:typeof t=="object"?Object.keys(t).length===0:!1}static copyObj(t){return JSON.parse(JSON.stringify(t))}}function ve(e){return typeof e!="string"?!1:e.match(/^[a-zA-Z0-9-]+@[a-zA-Z0-9-_]+$/)}function Le(e){console.log("%c设置组件包","color:green;",e),k.addLocalPackage(e.packageConfig,e)}function Me(e){console.debug("%c注册组件包","color:green;",e),k.registerPackage(e)}function Be(e=500){return r.defineAsyncComponent({loader:()=>new Promise(async(t,n)=>{try{setTimeout(()=>{t(function(){return""})},e)}catch(o){n(o)}})})}function Ue(e){return k.getComponentOption(e)}function Q(e,t={}){e=k.parseComponentName(e);const n=Object.assign({errorComponent:function(o){return`组件加载失败:${e}`},loadingComponent:X},t);return r.defineAsyncComponent({loader:()=>new Promise(async(o,a)=>{try{console.debug("-- 加载组件:",e);let s=await k.component(e);if(!s){a(new Error("组件不存在:"+e));return}o(s)}catch(s){a(s)}}),...n})}const ze={key:1,class:"m-component-error"},Fe={class:"error-msg"},Ve={name:"lp-component",inheritAttrs:!1},M=r.defineComponent({...Ve,props:{is:{type:String,default:""}},setup(e){const t=e,n=r.ref(!1),o=r.ref("");let a=null;const s=Q(t.is,{loadingComponent:X,errorComponent:function(u){return""},onError:(u,g,P,E)=>{console.error("onError",E),a=g,n.value=!0,o.value=`组件加载失败: ${u.message}`,P()}});r.watch(()=>t.is,(u,g)=>{});function d(){n.value=!1,o.value="",a==null||a()}r.onErrorCaptured((u,g,P)=>(console.log("onErrorCaptured",u,g,P),!1));const i=r.useAttrs(),m=r.useSlots();console.log("$slots",m),console.log("$attrs",i);const l=r.computed(()=>Object.keys(i).reduce((u,g)=>(g.startsWith("on")||(u[g]=i[g]),u),{})),b=r.computed(()=>Object.keys(i).reduce((u,g)=>{if(g.startsWith("on")){const P=g.slice(2).replace(/^\w/,E=>E.toLowerCase());u[P]=i[g]}return u},{}));return r.computed(()=>{const u={};return"modelValue"in i&&(u.modelValue=i.modelValue),u}),r.computed(()=>{const u={};return"onUpdate:modelValue"in i&&(u["update:modelValue"]=i["onUpdate:modelValue"]),u}),console.log("filteredAttrs",l.value),console.log("formattedListeners",b.value),(u,g)=>(r.openBlock(),r.createElementBlock(r.Fragment,null,[e.is?(r.openBlock(),r.createBlock(r.resolveDynamicComponent(r.unref(s)),r.mergeProps({key:0},l.value,r.toHandlers(b.value)),r.createSlots({_:2},[r.renderList(r.unref(m),(P,E)=>({name:E,fn:r.withCtx(En=>[r.renderSlot(u.$slots,E,r.normalizeProps(r.guardReactiveProps(En||{})))])}))]),1040)):r.createCommentVNode("",!0),n.value?(r.openBlock(),r.createElementBlock("div",ze,[r.createElementVNode("div",Fe,r.toDisplayString(o.value),1),r.createElementVNode("button",{class:"btn btn-primary link",onClick:r.withModifiers(d,["stop"])},"重试")])):r.createCommentVNode("",!0)],64))}}),Ge=Object.freeze(Object.defineProperty({__proto__:null,LpComponent:M,default:{install:e=>{e.component(M.name,M)}}},Symbol.toStringTag,{value:"Module"}));var Y=typeof global=="object"&&global&&global.Object===Object&&global,qe=typeof self=="object"&&self&&self.Object===Object&&self,w=Y||qe||Function("return this")(),B=w.Symbol,ee=Object.prototype,De=ee.hasOwnProperty,We=ee.toString,A=B?B.toStringTag:void 0;function Re(e){var t=De.call(e,A),n=e[A];try{e[A]=void 0;var o=!0}catch{}var a=We.call(e);return o&&(t?e[A]=n:delete e[A]),a}var xe=Object.prototype,He=xe.toString;function Je(e){return He.call(e)}var Ne="[object Null]",Ke="[object Undefined]",te=B?B.toStringTag:void 0;function O(e){return e==null?e===void 0?Ke:Ne:te&&te in Object(e)?Re(e):Je(e)}function U(e){return e!=null&&typeof e=="object"}var ne=Array.isArray;function oe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ze="[object AsyncFunction]",Xe="[object Function]",Qe="[object GeneratorFunction]",Ye="[object Proxy]";function re(e){if(!oe(e))return!1;var t=O(e);return t==Xe||t==Qe||t==Ze||t==Ye}var q=w["__core-js_shared__"],ae=function(){var e=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function et(e){return!!ae&&ae in e}var tt=Function.prototype,nt=tt.toString;function _(e){if(e!=null){try{return nt.call(e)}catch{}try{return e+""}catch{}}return""}var ot=/[\\^$.*+?()[\]{}|]/g,rt=/^\[object .+?Constructor\]$/,at=Function.prototype,st=Object.prototype,ct=at.toString,it=st.hasOwnProperty,lt=RegExp("^"+ct.call(it).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ut(e){if(!oe(e)||et(e))return!1;var t=re(e)?lt:rt;return t.test(_(e))}function dt(e,t){return e==null?void 0:e[t]}function I(e,t){var n=dt(e,t);return ut(n)?n:void 0}var D=I(w,"WeakMap"),ft=9007199254740991;function se(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ft}function pt(e){return e!=null&&se(e.length)&&!re(e)}var mt=Object.prototype;function ce(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||mt;return e===n}var gt="[object Arguments]";function ie(e){return U(e)&&O(e)==gt}var le=Object.prototype,yt=le.hasOwnProperty,bt=le.propertyIsEnumerable,ht=ie(function(){return arguments}())?ie:function(e){return U(e)&&yt.call(e,"callee")&&!bt.call(e,"callee")};function wt(){return!1}var ue=typeof c=="object"&&c&&!c.nodeType&&c,de=ue&&typeof module=="object"&&module&&!module.nodeType&&module,jt=de&&de.exports===ue,fe=jt?w.Buffer:void 0,Ct=fe?fe.isBuffer:void 0,_t=Ct||wt,$t="[object Arguments]",St="[object Array]",Ot="[object Boolean]",Tt="[object Date]",Pt="[object Error]",Et="[object Function]",kt="[object Map]",At="[object Number]",It="[object Object]",vt="[object RegExp]",Lt="[object Set]",Mt="[object String]",Bt="[object WeakMap]",Ut="[object ArrayBuffer]",zt="[object DataView]",Ft="[object Float32Array]",Vt="[object Float64Array]",Gt="[object Int8Array]",qt="[object Int16Array]",Dt="[object Int32Array]",Wt="[object Uint8Array]",Rt="[object Uint8ClampedArray]",xt="[object Uint16Array]",Ht="[object Uint32Array]",f={};f[Ft]=f[Vt]=f[Gt]=f[qt]=f[Dt]=f[Wt]=f[Rt]=f[xt]=f[Ht]=!0,f[$t]=f[St]=f[Ut]=f[Ot]=f[zt]=f[Tt]=f[Pt]=f[Et]=f[kt]=f[At]=f[It]=f[vt]=f[Lt]=f[Mt]=f[Bt]=!1;function Jt(e){return U(e)&&se(e.length)&&!!f[O(e)]}function Nt(e){return function(t){return e(t)}}var pe=typeof c=="object"&&c&&!c.nodeType&&c,v=pe&&typeof module=="object"&&module&&!module.nodeType&&module,Kt=v&&v.exports===pe,W=Kt&&Y.process,me=function(){try{var e=v&&v.require&&v.require("util").types;return e||W&&W.binding&&W.binding("util")}catch{}}(),ge=me&&me.isTypedArray,Zt=ge?Nt(ge):Jt;function Xt(e,t){return function(n){return e(t(n))}}var Qt=Xt(Object.keys,Object),Yt=Object.prototype,en=Yt.hasOwnProperty;function tn(e){if(!ce(e))return Qt(e);var t=[];for(var n in Object(e))en.call(e,n)&&n!="constructor"&&t.push(n);return t}var R=I(w,"Map"),x=I(w,"DataView"),H=I(w,"Promise"),J=I(w,"Set"),ye="[object Map]",nn="[object Object]",be="[object Promise]",he="[object Set]",we="[object WeakMap]",je="[object DataView]",on=_(x),rn=_(R),an=_(H),sn=_(J),cn=_(D),$=O;(x&&$(new x(new ArrayBuffer(1)))!=je||R&&$(new R)!=ye||H&&$(H.resolve())!=be||J&&$(new J)!=he||D&&$(new D)!=we)&&($=function(e){var t=O(e),n=t==nn?e.constructor:void 0,o=n?_(n):"";if(o)switch(o){case on:return je;case rn:return ye;case an:return be;case sn:return he;case cn:return we}return t});var ln="[object String]";function un(e){return typeof e=="string"||!ne(e)&&U(e)&&O(e)==ln}var dn="[object Map]",fn="[object Set]",pn=Object.prototype,mn=pn.hasOwnProperty;function gn(e){if(e==null)return!0;if(pt(e)&&(ne(e)||typeof e=="string"||typeof e.splice=="function"||_t(e)||Zt(e)||ht(e)))return!e.length;var t=$(e);if(t==dn||t==fn)return!e.size;if(ce(e))return!tn(e).length;for(var n in e)if(mn.call(e,n))return!1;return!0}const S=[];function yn(e){if(S.find(n=>n.name===e.name)){console.error("网关已存在");return}S.push(e)}async function Ce(e){var s;console.log("## 获取图标包",e);let t=null;for(let d in S){let i=S[d];if(i.packages&&((s=i.packages)!=null&&s.includes(e))){t=i;break}}let n=t||S[0];if(!n)throw console.log("没有网关",e,S),new Error("没有网关");let o=await h.post(n.url,{name:e});if(o.data.code!==200)throw new Error(o.data.msg);if(!o.data.data.row)throw new Error("图标包不存在");return o.data.data.row}const T={},z={};async function _e(e){let t=hn(e),n=T[t.package];if(n||(z[t.package]&&await Z(()=>!!T[t.package]),n=T[t.package]),!n)try{z[t.package]=1,n=await Ce(t.package),T[t.package]=n,delete z[t.package]}catch(o){throw delete z[t.package],console.error("加载图标包失败",o),o}if($e(n),!n.icons[t.icon])throw new Error("图标不存在");return n.icons[t.icon]}function bn(e){T[e.name]=e}function hn(e){if(!e.includes("@"))return{package:"default",icon:e};let[t,n]=e.split("@");return{package:t,icon:n}}const F={};function $e(e){if(F[e.name])return;const t=document.createElement("style"),n=e.name||"iconfont",o=(e.data.woff2.startsWith("//"),e.data.woff2),a=(e.data.woff.startsWith("//"),e.data.woff),s=(e.data.truetype.startsWith("//"),e.data.truetype);t.innerHTML=`
        @font-face {
            font-family: '${n}';
            src: url('${o}') format('woff2'),
                 url('${a}') format('woff'),
                 url('${s}') format('truetype');
        }
    `,document.head.appendChild(t),F[e.name]=t,console.log("已挂载字体:",e.name)}function wn(e){const t=F[e.name];t&&t.parentNode&&(t.parentNode.removeChild(t),delete F[e.name],console.log("已卸载字体:",e.name))}const jn=["innerHTML"],Cn={name:"lp-icon"},V=r.defineComponent({...Cn,props:{is:{default:"loading"},size:{default:12},color:{default:"#000000"}},emits:["click"],setup(e,{emit:t}){const n=t,o=r.useAttrs(),a={},s=r.ref(""),d=e;r.watch(()=>d.is,async(l,b)=>{if(l!==b){if(a[l]){s.value="&#x"+a[l];return}try{a[l]=await _e(l),s.value="&#x"+a[l]}catch(u){console.error("加载图标失败",u)}}},{immediate:!0});const i=r.computed(()=>{const{size:l,color:b}=d;let u=l;return un(l)&&(u=parseInt(l,10)),{fontSize:`${u}px`,color:b,display:"inline-flex",fontFamily:"'default'"}}),m=l=>{n("click",l)};return(l,b)=>(r.openBlock(),r.createElementBlock("i",{class:r.normalizeClass(["lp-icon1",[r.unref(o).class]]),style:r.normalizeStyle(i.value),innerHTML:s.value,onClick:m},null,14,jn))}}),_n=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n},$n=["fill"],Sn=["xlink:href"],G=_n(Object.assign({name:"LpSvg"},{props:{icon:{type:String,required:!0},size:{type:[Number,String],default:12},color:{type:String,default:"#000000"}},setup(e){const t=e,n=r.computed(()=>`#${t.icon}`),o=r.computed(()=>{const{size:a,color:s}=t;let d=`${a}`;return d=`${d.replace("px","")}px`,{width:d,fill:s,height:d}});return(a,s)=>(r.openBlock(),r.createElementBlock("svg",{class:r.normalizeClass([a.$attrs.class]),style:r.normalizeStyle(o.value),fill:e.color,"aria-hidden":"true"},[r.createElementVNode("use",{"xlink:href":n.value},null,8,Sn)],14,$n))}}),[["__scopeId","data-v-4508aad0"]]),On=Object.freeze(Object.defineProperty({__proto__:null,LpIcon:V,LpSvg:G,default:{install:e=>{e.component(V.name,V),e.component(G.name,G)}}},Symbol.toStringTag,{value:"Module"}));function Se(e){const t=Object.assign({"./lp-component/index.ts":Ge,"./lp-icon/index.ts":On});console.debug("%cglobalComponents","color:green",t),Object.keys(t).forEach(n=>{const o=t[n].default;gn(o)||e.use(o)})}function Tn(e){e=e||{};const t=h.create({baseURL:e.baseURL,timeout:e.timeout||1e4,headers:{...e.headers||{}}});return e.requestInterceptors&&t.interceptors.request.use(e.requestInterceptors,n=>(console.log("request",{err:n}),Promise.reject(n))),e.responseInterceptors&&t.interceptors.response.use(e.responseInterceptors,n=>(console.log("response err",{err:n}),Promise.reject(n))),e.baseInterceptors&&!(e.requestInterceptors||e.responseInterceptors)&&(t.interceptors.request.use(n=>(console.log("request",{config:n}),n)),t.interceptors.response.use(n=>(console.log("response",{response:n}),n.data))),t}function Oe(e){Se(e)}const Pn={install:Oe};c.IconPackages=T,c.JsDataType=Ie,c.LpComponent=M,c.LpIcon=V,c.LpSvg=G,c.asyncComponentDelay=Be,c.createApi=Tn,c.default=Pn,c.gatewayOptions=j,c.getComponentOption=Ue,c.getComponentPackage=K,c.getIconPackage=Ce,c.iconGatewayOptions=S,c.install=Oe,c.loadComponent=Q,c.loadIcon=_e,c.mountIconfont=$e,c.nameIsUseAsyncComponent=ve,c.registerLooplanComponents=Se,c.registerPackage=Me,c.setComponentPackage=Le,c.setGateway=Te,c.setIconGateway=yn,c.setIconPackage=bn,c.unmountIconfont=wn,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
